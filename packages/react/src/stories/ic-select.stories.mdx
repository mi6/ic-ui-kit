
import { useState, useEffect } from "react";
import {
  Meta,
  Story,
  Canvas,
  ArgsTable,
  Description,
} from "@storybook/addon-docs";

import { IcSelect, IcButton } from "../components";
import readme from "../../../web-components/src/components/ic-select/readme.md";

<Meta title="React Components/Select" component={IcSelect} />

export const options = [
  { label: "Cappuccino", value: "Cap" },
  { label: "Latte", value: "Lat" },
  { label: "Americano", value: "Ame" },
];

export const optionsWithDisabled = [
  { label: "Cappuccino", value: "Cap" },
  { label: "Latte", value: "Lat", disabled: true },
  { label: "Americano", value: "Ame" },
];

export const optionsWithDescriptions = [
  {
    label: "Cappuccino",
    value: "Cap",
    description: "Coffee frothed up with pressurised steam",
  },
  {
    label: "Latte",
    value: "Lat",
    description: "A milkier coffee than a cappuccino",
  },
  {
    label: "Americano",
    value: "Ame",
    description: "Espresso coffee diluted with hot water",
  },
];

export const groupedOptions = [
  {
    label: "Fancy",
    children: [
      { label: "Cappuccino", value: "Cap" },
      { label: "Flat white", value: "Flat" },
    ],
  },
  {
    label: "Boring",
    children: [
      { label: "Filter", value: "Fil" },
      { label: "Latte", value: "Lat" },
    ],
  },
];

export const optionsWithRecommended = [
  { label: "Cappuccino", value: "Cappuccino" },
  { label: "Flat white", value: "Flat white", recommended: true },
  { label: "Latte", value: "Latte" },
  { label: "Americano", value: "Americano", recommended: true },
  { label: "Filter", value: "Fil" },
];

export const manyOptions = [
  { label: "Cappuccino", value: "Cap" },
  { label: "Latte", value: "Lat" },
  { label: "Americano", value: "Ame" },
  { label: "Filter", value: "Fil" },
  { label: "Flat white", value: "Fla" },
  { label: "Mocha", value: "Moc" },
  { label: "Macchiato", value: "Mac" },
  { label: "Caf√© au lait", value: "Caf" },
  { label: "Espresso", value: "Esp" },
  { label: "Cortado", value: "Cor" },
  { label: "Ristretto", value: "Ris" },
  { label: "Latte macchiato", value: "Lam" },
];

export const searchableOptions = [
  { label: "Cappuccino", value: "Cap" },
  { label: "Latte", value: "Lat" },
  { label: "Americano", value: "Ame" },
  { label: "Filter", value: "Fil" },
  { label: "Flat white", value: "Fla" },
  { label: "Mocha", value: "Moc" },
  { label: "Macchiato", value: "Mac" },
];

export const searchableOptionsWithDescriptions = [
  {
    label: "Cappuccino",
    value: "Cap",
    description: "Coffee frothed up with pressurised steam",
  },
  {
    label: "Latte",
    value: "Lat",
    description: "A milkier coffee than a cappuccino",
  },
  {
    label: "Americano",
    value: "Ame",
    description: "Espresso coffee diluted with hot water",
  },
  {
    label: "Filter",
    value: "Fil",
    description: "Coffee filtered using paper or a mesh",
  },
  {
    label: "Flat white",
    value: "Fla",
    description:
      "Coffee without froth made with espresso and hot steamed milk",
  },
  {
    label: "Mocha",
    value: "Moc",
    description: "A mixture of coffee and chocolate",
  },
  {
    label: "Macchiato",
    value: "Mac",
    description: "Espresso coffee with a dash of frothy steamed milk",
  },
];

export const searchableOptionsWithDisabled = [
  { label: "Cappuccino", value: "Cap" },
  { label: "Latte", value: "Lat" },
  { label: "Americano", value: "Ame", disabled: true },
  { label: "Filter", value: "Fil", disabled: true },
  { label: "Flat white", value: "Fla" },
  { label: "Mocha", value: "Moc" },
  { label: "Macchiato", value: "Mac", disabled: true },
];

export const searchableOptionsWithRecommended = [
  { label: "Cappuccino", value: "Cappuccino" },
  { label: "Flat white", value: "Flat white", recommended: true },
  { label: "Latte", value: "Latte" },
  { label: "Americano", value: "Americano", recommended: true },
  { label: "Filter", value: "Fil" },
  { label: "Mocha", value: "Moc" },
  { label: "Macchiato", value: "Mac" },
];

### Default

<Canvas>
  <Story name="Default">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={options}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Default value

<Canvas>
  <Story name="Default value">
    {() => {
      const [value, setValue] = useState("Cap");
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={options}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### With clear button

<Canvas>
  <Story name="With clear button">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          showClearButton
          options={options}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### With description

<Canvas>
  <Story name="With description">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={optionsWithDescriptions}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Helper text

<Canvas>
  <Story name="Helper text">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          helperText="Some helper text"
          options={options}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Custom placeholder

<Canvas>
  <Story name="Custom placeholder">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          placeholder="Placeholder goes here"
          options={options}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Small

<Canvas>
  <Story name="Small">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          small
          options={options}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Disabled

<Canvas>
  <Story name="Disabled">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          disabled
          options={options}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Disabled options

<Canvas>
  <Story name="Disabled options">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={optionsWithDisabled}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Full width

<Canvas>
  <Story name="Full width">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          fullWidth
          options={options}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Hidden label

<Canvas>
  <Story name="Hidden label">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          hideLabel
          options={options}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Required

<Canvas>
  <Story name="Required">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          required
          options={options}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Read-only

<Canvas>
  <Story name="Read-only">
    {() => {
      const [value, setValue] = useState("Cap");
      return (
        <IcSelect
          label="What is your favourite coffee?"
          readonly
          options={options}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Groups

<Canvas>
  <Story name="Groups">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={groupedOptions}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Recommended

<Canvas>
  <Story name="Recommended">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={optionsWithRecommended}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Validation

<Canvas>
  <Story name="Validation">
    {() => {
      const [value1, setValue1] = useState(null);
      const [value2, setValue2] = useState(null);
      const [value3, setValue3] = useState(null);
      return (
        <div>
          <IcSelect
            label="What is your favourite coffee?"
            validationStatus="success"
            validationText="Success message"
            options={options}
            value={value1}
            onIcChange={(event) => setValue1(event.detail.value)}
          ></IcSelect>
          <IcSelect
            label="What is your favourite coffee?"
            validationStatus="warning"
            validationText="Warning message"
            options={options}
            value={value2}
            onIcChange={(event) => setValue2(event.detail.value)}
          ></IcSelect>
          <IcSelect
            label="What is your favourite coffee?"
            validationStatus="error"
            validationText="Error message"
            options={options}
            value={value3}
            onIcChange={(event) => setValue3(event.detail.value)}
          ></IcSelect>
        </div>
      );
    }}
  </Story>
</Canvas>

### Scroll behaviour

<Canvas>
  <Story name="Scroll behaviour">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={manyOptions}
          value={value}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable default

<Canvas>
  <Story name="Searchable default">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptions}
          value={value}
          searchable
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

export const SearchableDefaultValue = () => {
  const [value, setValue] = useState('Cap'); 
  return (
    <IcSelect
      label="What is your favourite coffee?"
      required
      value={value}
      options={searchableOptions}
      onIcChange={e => setValue(e.detail.value || '')}
      searchable
      showClearButton
    />
)}

### Searchable default value

<Canvas>
  <Story name="Searchable default value">
    {() => {
      return (
        <SearchableDefaultValue />
      );
    }}
  </Story>
</Canvas>

export const SearchableFormDefaultValue = () => {
  const [value, setValue] = useState('Cap'); 
  return (
    <form>
      <IcSelect
        label="What is your favourite coffee?"
        required
        value={value}
        options={searchableOptions}
        onIcChange={e => setValue(e.detail.value || '')}
        searchable
        showClearButton
      />
      <IcButton type='reset'>Reset</IcButton>
    </form>
)}

### Searchable Form reset default value

<Canvas>
  <Story name="Searchable form reset default value">
    {() => {
      return (
        <SearchableFormDefaultValue />
      );
    }}
  </Story>
</Canvas>

### Searchable filter by start of options

<Canvas>
  <Story name="Searchable filter by start of options">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptions}
          value={value}
          searchable
          filterMatchPosition="start"
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable characters until suggestions

<Canvas>
  <Story name="Searchable characters until suggestions">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptions}
          value={value}
          searchable
          charactersUntilSuggestions={3}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable with description

<Canvas>
  <Story name="Searchable with description">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptionsWithDescriptions}
          value={value}
          searchable
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable with description (included in search)

<Canvas>
  <Story name="Searchable with description (included in search)">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptionsWithDescriptions}
          value={value}
          searchable
          includeDescriptionsInSearch
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable helper text

<Canvas>
  <Story name="Searchable helper text">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptions}
          value={value}
          searchable
          helperText="Some helper text"
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable small

<Canvas>
  <Story name="Searchable small">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptions}
          value={value}
          searchable
          small
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable disabled

<Canvas>
  <Story name="Searchable disabled">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptions}
          value={value}
          searchable
          disabled
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable disabled options

<Canvas>
  <Story name="Searchable disabled options">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptionsWithDisabled}
          value={value}
          searchable
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable hidden label

<Canvas>
  <Story name="Searchable hidden label">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptions}
          value={value}
          searchable
          hideLabel
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable required

<Canvas>
  <Story name="Searchable required">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptions}
          value={value}
          searchable
          required
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable groups

<Canvas>
  <Story name="Searchable groups">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={groupedOptions}
          value={value}
          searchable
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable groups (group titles included in search)

<Canvas>
  <Story name="Searchable groups (group titles included in search)">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={groupedOptions}
          value={value}
          searchable
          includeGroupTitlesInSearch
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable groups characters until suggestions

<Canvas>
  <Story name="Searchable groups characters until suggestions">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={groupedOptions}
          value={value}
          searchable
          charactersUntilSuggestions={3}
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable recommended

<Canvas>
  <Story name="Searchable recommended">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptionsWithRecommended}
          value={value}
          searchable
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable validation

<Canvas>
  <Story name="Searchable validation">
    {() => {
      const [value1, setValue1] = useState(null);
      const [value2, setValue2] = useState(null);
      const [value3, setValue3] = useState(null);
      return (
        <div>
          <IcSelect
            label="What is your favourite coffee?"
            validationStatus="success"
            validationText="Success message"
            options={options}
            value={value1}
            searchable
            onIcChange={(event) => setValue1(event.detail.value)}
          ></IcSelect>
          <IcSelect
            label="What is your favourite coffee?"
            validationStatus="warning"
            validationText="Warning message"
            options={options}
            value={value2}
            searchable
            onIcChange={(event) => setValue2(event.detail.value)}
          ></IcSelect>
          <IcSelect
            label="What is your favourite coffee?"
            validationStatus="error"
            validationText="Error message"
            options={options}
            value={value3}
            searchable
            onIcChange={(event) => setValue3(event.detail.value)}
          ></IcSelect>
        </div>
      );
    }}
  </Story>
</Canvas>

### Searchable many options

<Canvas>
  <Story name="Searchable many options">
    {() => {
      const [value, setValue] = useState(null);
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={manyOptions}
          value={value}
          searchable
          onIcChange={(event) => setValue(event.detail.value)}
        ></IcSelect>
      );
    }}
  </Story>
</Canvas>

### Searchable external filtering

export const ExternalFiltering = () => {
   const mockData = [
    { label: "Espresso", value: "Esp" },
    { label: "Double Espresso", value: "Dou" },
    { label: "Cappuccino", value: "Cap" },
    { label: "Latte", value: "Lat" },
    { label: "Americano", value: "Ame" },
    { label: "Filter", value: "Fil" },
    { label: "Flat white", value: "Fla" },
    { label: "Mocha", value: "Moc" },
    { label: "Macchiato", value: "Mac" },
  ];
  const [query, setQuery] = useState('');
  const [value, setValue] = useState(null);
  const [selectedValue, setSelectedValue] = useState(null);
  const [results, setResults] = useState([]);
  useEffect(() => {
    if (query !== selectedValue) {
      if (query && query.length > 1) {
        const mockAPI = (query) => {
          const filteredResults = mockData.filter(m => m.label.toLowerCase().includes(query.toLowerCase()));
          return new Promise(resolve => setTimeout(() => resolve(filteredResults), 1000));
        };
        mockAPI(query).then((results) => setResults(results));
      } else {
        setResults([]);
      }
    }
  },[query])
  const handleChange = (event) => {
    setValue(event.detail.value);
    setQuery(event.detail.value);
  }
  const handleOptionSelect = (event) =>{
    setSelectedValue(event.detail.value);
  }
  const handleClear = () => {
    setResults([]);
  }
  return (
    <IcSelect debounce={300} label="What is your favourite coffee?" searchable disableFilter charactersUntilSuggestions="2" options={results} onIcOptionSelect={handleOptionSelect} onIcChange={handleChange} onIcClear={handleClear} value={value}/>
  );
};

<Canvas>
  <Story name="Searchable external filtering">
   <ExternalFiltering />
    <br/>
    <IcTypography>Suggested search options: Espresso, Double Espresso, Flat White, Filter, Cappuccino, Americano, Mocha, Macchiato.</IcTypography>
    <br/>
    <IcTypography>The IcChange event will trigger 300ms after you finish typing. 1 second later, the options in the select menu will be updated.</IcTypography>
  </Story>
</Canvas>