import { useState, useEffect } from "react";
import {
  Meta,
  Story,
  Canvas,
  ArgsTable,
  Description,
} from "@storybook/addon-docs";

import { IcSelect, IcButton, IcTypography } from "../components";
import readme from "../../../web-components/src/components/ic-select/readme.md";

<Meta title="Select" component={IcSelect} />

<Description markdown={readme} />

export const defaultArgs = {
  disabled: false,
  fullWidth: false,
  helperText: "Such as Arabica, Robusta or Liberica.",
  hideLabel: false,
  loading: false,
  loadingLabel: "Loading...",
  label: "What is your favourite coffee?",
  placeholder: "Select an option",
  readonly: false,
  required: false,
  small: false,
  validationStatus: "",
  validationText: "",
};

export const options = [
  { label: "Cappuccino", value: "Cap" },
  { label: "Latte", value: "Lat" },
  { label: "Americano", value: "Ame" },
];

export const optionsWithDisabled = [
  { label: "Cappuccino", value: "Cap" },
  { label: "Latte", value: "Lat", disabled: true },
  { label: "Americano", value: "Ame" },
];

export const optionsWithDescriptions = [
  {
    label: "Cappuccino",
    value: "Cap",
    description: "Coffee frothed up with pressurised steam",
  },
  {
    label: "Latte",
    value: "Lat",
    description: "A milkier coffee than a cappuccino",
  },
  {
    label: "Americano",
    value: "Ame",
    description: "Espresso coffee diluted with hot water",
  },
];

export const groupedOptions = [
  {
    label: "Fancy",
    children: [
      { label: "Cappuccino", value: "Cap" },
      { label: "Flat white", value: "Flat" },
    ],
  },
  {
    label: "Boring",
    children: [
      { label: "Filter", value: "Fil" },
      { label: "Latte", value: "Lat" },
    ],
  },
];

export const optionsWithRecommended = [
  { label: "Cappuccino", value: "Cappuccino" },
  { label: "Flat white", value: "Flat white", recommended: true },
  { label: "Latte", value: "Latte" },
  { label: "Americano", value: "Americano", recommended: true },
  { label: "Filter", value: "Fil" },
];

export const optionsWithCustomElements = [
  {
    label: "Cappuccino",
    value: "Cap",
  },
  {
    label: "Latte",
    value: "Lat",
    element: {
      component: `<ic-status-tag label="Neutral status"></ic-status-tag>`,
      ariaLabel: "Neutral status tag",
    },
  },
  {
    label: "Americano",
    value: "Ame",
    icon: `<svg aria-labelledby="warning-title" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#000000"><g id="warning"><path id="Vector" d="M4.47 20.5037H19.53C21.07 20.5037 22.03 18.8337 21.26 17.5037L13.73 4.49375C12.96 3.16375 11.04 3.16375 10.27 4.49375L2.74 17.5037C1.97 18.8337 2.93 20.5037 4.47 20.5037ZM12 13.5037C11.45 13.5037 11 13.0537 11 12.5037V10.5037C11 9.95375 11.45 9.50375 12 9.50375C12.55 9.50375 13 9.95375 13 10.5037V12.5037C13 13.0537 12.55 13.5037 12 13.5037ZM13 17.5037H11V15.5037H13V17.5037Z" /></g></svg>`,
  },
];

export const manyOptions = [
  { label: "Cappuccino", value: "Cap" },
  { label: "Latte", value: "Lat" },
  { label: "Americano", value: "Ame" },
  { label: "Filter", value: "Fil" },
  { label: "Flat white", value: "Fla" },
  { label: "Mocha", value: "Moc" },
  { label: "Macchiato", value: "Mac" },
  { label: "Caf√© au lait", value: "Caf" },
  { label: "Espresso", value: "Esp" },
  { label: "Cortado", value: "Cor" },
  { label: "Ristretto", value: "Ris" },
  { label: "Latte macchiato", value: "Lam" },
];

export const searchableOptions = [
  { label: "Cappuccino", value: "Cap" },
  { label: "Latte", value: "Lat" },
  { label: "Americano", value: "Ame" },
  { label: "Filter", value: "Fil" },
  { label: "Flat white", value: "Fla" },
  { label: "Mocha", value: "Moc" },
  { label: "Macchiato", value: "Mac" },
];

export const searchableOptionsWithDescriptions = [
  {
    label: "Cappuccino",
    value: "Cap",
    description: "Coffee frothed up with pressurised steam",
  },
  {
    label: "Latte",
    value: "Lat",
    description: "A milkier coffee than a cappuccino",
  },
  {
    label: "Americano",
    value: "Ame",
    description: "Espresso coffee diluted with hot water",
  },
  {
    label: "Filter",
    value: "Fil",
    description: "Coffee filtered using paper or a mesh",
  },
  {
    label: "Flat white",
    value: "Fla",
    description: "Coffee without froth made with espresso and hot steamed milk",
  },
  {
    label: "Mocha",
    value: "Moc",
    description: "A mixture of coffee and chocolate",
  },
  {
    label: "Macchiato",
    value: "Mac",
    description: "Espresso coffee with a dash of frothy steamed milk",
  },
];

export const searchableOptionsWithDisabled = [
  { label: "Cappuccino", value: "Cap" },
  { label: "Latte", value: "Lat" },
  { label: "Americano", value: "Ame", disabled: true },
  { label: "Filter", value: "Fil", disabled: true },
  { label: "Flat white", value: "Fla" },
  { label: "Mocha", value: "Moc" },
  { label: "Macchiato", value: "Mac", disabled: true },
];

export const searchableOptionsWithRecommended = [
  { label: "Cappuccino", value: "Cappuccino" },
  { label: "Flat white", value: "Flat white", recommended: true },
  { label: "Latte", value: "Latte" },
  { label: "Americano", value: "Americano", recommended: true },
  { label: "Filter", value: "Fil" },
  { label: "Mocha", value: "Moc" },
  { label: "Macchiato", value: "Mac" },
];

export const playgroundOptions = [
  {
    label: "Cappuccino",
    value: "Cap",
    description: "Coffee frothed up with pressurised steam",
  },
  {
    label: "Boring",
    children: [
      {
        label: "Latte",
        value: "Lat",
        description: "A milkier coffee than a cappuccino",
      },
      {
        label: "Filter",
        value: "Fil",
        description: "Coffee filtered using paper or a mesh",
      },
    ],
  },
  {
    label: "Fancy",
    children: [
      {
        label: "Flat white",
        value: "Fla",
        description:
          "Coffee without froth made with espresso and hot steamed milk",
      },
      {
        label: "Macchiato",
        value: "Mac",
        description: "Espresso coffee with a dash of frothy steamed milk",
      },
    ],
  },
  {
    label: "Americano",
    value: "Ame",
    description: "Espresso coffee diluted with hot water",
  },
  {
    label: "Mocha",
    value: "Moc",
    description: "A mixture of coffee and chocolate",
  },
];

### Default

<Canvas>
  <Story name="Default">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={options}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Default value

<Canvas>
  <Story name="Default value">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={options}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### With clear button

<Canvas>
  <Story name="With clear button">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          showClearButton
          options={options}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### With description

<Canvas>
  <Story name="With description">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={optionsWithDescriptions}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Helper text

<Canvas>
  <Story name="Helper text">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          helperText="Some helper text"
          options={options}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Custom placeholder

<Canvas>
  <Story name="Custom placeholder">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          placeholder="Placeholder goes here"
          options={options}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Custom elements

<Canvas>
  <Story name="Custom elements">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={optionsWithCustomElements}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Size small

<Canvas>
  <Story name="Size small">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          size="small"
          options={options}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Deprecated - small

<Canvas>
  <Story name="Deprecated - small">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          small
          options={options}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Disabled

<Canvas>
  <Story name="Disabled">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          disabled
          options={options}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Disabled options

<Canvas>
  <Story name="Disabled options">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={optionsWithDisabled}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Full width

<Canvas>
  <Story name="Full width">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          fullWidth
          options={options}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Hidden label

<Canvas>
  <Story name="Hidden label">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          hideLabel
          options={options}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Required

<Canvas>
  <Story name="Required">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          required
          options={options}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Read-only

<Canvas>
  <Story name="Read-only">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          readonly
          options={options}
          value="Cap"
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Groups

<Canvas>
  <Story name="Groups">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={groupedOptions}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Recommended

<Canvas>
  <Story name="Recommended">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={optionsWithRecommended}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Validation

<Canvas>
  <Story name="Validation">
    {() => {
      return (
        <div>
          <IcSelect
            label="What is your favourite coffee?"
            validationStatus="success"
            validationText="Success message"
            options={options}
            onIcChange={(event) => setValue1(event.detail.value)}
          />
          <IcSelect
            label="What is your favourite coffee?"
            validationStatus="warning"
            validationText="Warning message"
            options={options}
            onIcChange={(event) => setValue2(event.detail.value)}
          />
          <IcSelect
            label="What is your favourite coffee?"
            validationStatus="error"
            validationText="Error message"
            options={options}
            onIcChange={(event) => setValue3(event.detail.value)}
          />
        </div>
      );
    }}
  </Story>
</Canvas>

### Scroll behaviour

<Canvas>
  <Story name="Scroll behaviour">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={manyOptions}
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Emitting icOptionSelect on enter

<Canvas>
  <Story name="Emitting icOptionSelect on enter">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={options}
          selectOnEnter
          onIcOptionSelect={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Searchable default

<Canvas>
  <Story name="Searchable default">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptions}
          searchable
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

export const SearchableDefaultValue = () => {
  return (
    <IcSelect
      label="What is your favourite coffee?"
      required
      value="Cap"
      options={searchableOptions}
      onIcChange={(e) => console.log(e.detail.value)}
      searchable
      showClearButton
    />
  );
};

### Searchable default value

<Canvas>
  <Story name="Searchable default value">
    {() => {
      return <SearchableDefaultValue />;
    }}
  </Story>
</Canvas>

export const SearchableFormDefaultValue = () => {
  return (
    <form>
      <IcSelect
        label="What is your favourite coffee?"
        required
        value="Cap"
        options={searchableOptions}
        onIcChange={(e) => console.log(e.detail.value)}
        searchable
        showClearButton
      />
      <IcButton type="reset">Reset</IcButton>
    </form>
  );
};

### Searchable Form reset default value

<Canvas>
  <Story name="Searchable form reset default value">
    {() => {
      return <SearchableFormDefaultValue />;
    }}
  </Story>
</Canvas>

### Searchable filter by start of options

<Canvas>
  <Story name="Searchable filter by start of options">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptions}
          searchable
          filterMatchPosition="start"
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Searchable with description

<Canvas>
  <Story name="Searchable with description">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptionsWithDescriptions}
          searchable
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Searchable with description (included in search)

<Canvas>
  <Story name="Searchable with description (included in search)">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptionsWithDescriptions}
          searchable
          includeDescriptionsInSearch
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Searchable helper text

<Canvas>
  <Story name="Searchable helper text">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptions}
          searchable
          helperText="Some helper text"
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Searchable small

<Canvas>
  <Story name="Searchable small">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptions}
          searchable
          size="small"
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Searchable disabled

<Canvas>
  <Story name="Searchable disabled">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptions}
          searchable
          disabled
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Searchable disabled options

<Canvas>
  <Story name="Searchable disabled options">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptionsWithDisabled}
          searchable
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Searchable hidden label

<Canvas>
  <Story name="Searchable hidden label">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptions}
          searchable
          hideLabel
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Searchable required

<Canvas>
  <Story name="Searchable required">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptions}
          searchable
          required
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Searchable groups

<Canvas>
  <Story name="Searchable groups">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={groupedOptions}
          searchable
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Searchable groups (group titles included in search)

<Canvas>
  <Story name="Searchable groups (group titles included in search)">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={groupedOptions}
          searchable
          includeGroupTitlesInSearch
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Searchable recommended

<Canvas>
  <Story name="Searchable recommended">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={searchableOptionsWithRecommended}
          searchable
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Searchable validation

<Canvas>
  <Story name="Searchable validation">
    {() => {
      return (
        <div>
          <IcSelect
            label="What is your favourite coffee?"
            validationStatus="success"
            validationText="Success message"
            options={options}
            searchable
            onIcChange={(event) => setValue1(event.detail.value)}
          />
          <IcSelect
            label="What is your favourite coffee?"
            validationStatus="warning"
            validationText="Warning message"
            options={options}
            searchable
            onIcChange={(event) => setValue2(event.detail.value)}
          />
          <IcSelect
            label="What is your favourite coffee?"
            validationStatus="error"
            validationText="Error message"
            options={options}
            searchable
            onIcChange={(event) => setValue3(event.detail.value)}
          />
        </div>
      );
    }}
  </Story>
</Canvas>

### Searchable many options

<Canvas>
  <Story name="Searchable many options">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={manyOptions}
          searchable
          onIcChange={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Searchable external filtering

export const ExternalFiltering = () => {
  const mockData = [
    { label: "Espresso", value: "Esp" },
    { label: "Double Espresso", value: "Dou" },
    { label: "Cappuccino", value: "Cap" },
    { label: "Latte", value: "Lat" },
    { label: "Americano", value: "Ame" },
    { label: "Filter", value: "Fil" },
    { label: "Flat white", value: "Fla" },
    { label: "Mocha", value: "Moc" },
    { label: "Macchiato", value: "Mac" },
  ];
  const [event, setEvent] = useState();
  const [selectedValue, setSelectedValue] = useState(null);
  const [results, setResults] = useState([]);
  const [loading, setLoading] = useState(false);
  useEffect(() => {
    const searchTerm = event?.detail.value;
    if (searchTerm !== selectedValue) {
      if (searchTerm) {
        setLoading(true);
        const mockAPI = (query) => {
          const filteredResults = mockData.filter((m) =>
            m.label.toLowerCase().includes(query.toLowerCase())
          );
          return new Promise((resolve) =>
            setTimeout(
              () => resolve(filteredResults),
              event.type === "icChange" ? 2000 : 500
            )
          );
        };
        mockAPI(searchTerm).then((results) => setResults(results));
      } else {
        setResults([]);
      }
    }
  }, [event]);
  const handleChange = (event) => {
    console.log(event.detail.value);
    setEvent(event);
  };
  const handleOptionSelect = (event) => {
    setSelectedValue(event.detail.value);
  };
  const handleClear = () => {
    setResults([]);
  };
  return (
    <IcSelect
      loading={loading}
      timeout={1000}
      debounce={300}
      label="What is your favourite coffee?"
      searchable
      disableFilter
      options={results}
      onIcOptionSelect={handleOptionSelect}
      onIcChange={handleChange}
      onIcRetryLoad={handleChange}
      onIcClear={handleClear}
    />
  );
};

<Canvas>
  <Story name="Searchable external filtering">
    <ExternalFiltering />
    <br />
    <IcTypography>
      Suggested search options: Espresso, Double Espresso, Flat White, Filter,
      Cappuccino, Americano, Mocha, Macchiato.
    </IcTypography>
    <br />
    <IcTypography>
      The IcChange event will trigger 300ms after you finish typing. 1 second
      later, the options in the select menu will be updated.
    </IcTypography>
  </Story>
</Canvas>

### Searchable emitting icOptionSelect on enter

<Canvas>
  <Story name="Searchable emitting icOptionSelect on enter">
    {() => {
      return (
        <IcSelect
          label="What is your favourite coffee?"
          options={options}
          selectOnEnter
          searchable
          onIcOptionSelect={(event) => console.log(event.detail.value)}
        />
      );
    }}
  </Story>
</Canvas>

### Default select playground

<Canvas>
  <Story
    name="Default select playground"
    args={{ ...defaultArgs, showClearButton: false }}
    argTypes={{
      validationStatus: {
        options: ["none", "error", "success", "warning"],
        control: { type: "inline-radio" },
      },
    }}
  >
    {(args) => (
      <IcSelect
        id="select-playground"
        options={playgroundOptions}
        disabled={args.disabled}
        fullWidth={args.fullWidth}
        helperText={args.helperText}
        hideLabel={args.hideLabel}
        loading={args.loading}
        loadingLabel={args.loadingLabel}
        label={args.label}
        placeholder={args.placeholder}
        readonly={args.readonly}
        required={args.required}
        showClearButton={args.showClearButton}
        small={args.small}
        validationStatus={args.validationStatus}
        validationText={args.validationText}
      />
    )}
  </Story>
</Canvas>

### Searchable select playground

<Canvas>
  <Story
    name="Searchable select playground"
    args={{
      ...defaultArgs,
      includeDescriptionsInSearch: false,
      includeGroupTitlesInSearch: false,
      searchMatchPosition: "anywhere",
    }}
    argTypes={{
      searchMatchPosition: {
        options: ["anywhere", "start"],
        control: { type: "inline-radio" },
      },
      validationStatus: {
        options: ["none", "error", "success", "warning"],
        control: { type: "inline-radio" },
      },
    }}
  >
    {(args) => (
      <IcSelect
        id="select-searchable-playground"
        options={playgroundOptions}
        disabled={args.disabled}
        fullWidth={args.fullWidth}
        helperText={args.helperText}
        hideLabel={args.hideLabel}
        includeDescriptionsInSearch={args.includeDescriptionsInSearch}
        includeGroupTitlesInSearch={args.includeGroupTitlesInSearch}
        loading={args.loading}
        loadingLabel={args.loadingLabel}
        label={args.label}
        placeholder={args.placeholder}
        readonly={args.readonly}
        required={args.required}
        searchMatchPosition={args.searchMatchPosition}
        searchable
        small={args.small}
        validationStatus={args.validationStatus}
        validationText={args.validationText}
      />
    )}
  </Story>
</Canvas>
