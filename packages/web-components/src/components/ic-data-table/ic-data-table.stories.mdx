import {
  Meta,
  Story,
  Canvas,
  ArgsTable,
  Description,
} from "@storybook/addon-docs";
import {
  COLS,
  DATA,
  Basic,
  Embedded,
  Dense,
  Spacious,
  Scrollable,
  RowHeaders,
  Sort,
  SortOptions,
  Pagination,
  ColumnOverrides,
  RowOverrides,
  CellOverrides,
  LinksHTMLElements,
  Empty,
  EmptySlotted,
  Loading,
  Updating,
} from "./story-data";
import readme from "./readme.md";

<Meta
  title="Web Components/Data Table"
  component="ic-data-table"
  parameters={{
    componentAPI: {
      data: readme,
    },
  }}
/>

# [Canary]: Data Table

Use the data table component to display data in a tabular form.

There are two required props for data table:

- Caption: `string`
- Columns: `IcDataTableColumnObject[]`

Click the 'Component API' tab to view all the available props, events and slots for Data Tables.

To import the data table web component into your application, import `@ukic/canary-web-components` into your application.

### Basic

A basic example with no functionality.

<Canvas withSource="none">
  <Story name="Basic">{Basic()}</Story>
</Canvas>

#### Basic code example

```html
<ic-data-table id="data-table" caption="Basic Table"></ic-data-table>
<script>
  const dataTable1 = document.querySelector("#data-table");
  const columns = [
    {
      key: "firstName",
      title: "First name",
      // dataType types: "string" | "number" | "address" | "element" | "date";
      dataType: "string",
    },
    {
      key: "lastName",
      title: "Last name",
      dataType: "string",
    },
    {
      key: "age",
      title: "Age",
      dataType: "number",
    },
    {
      key: "jobTitle",
      title: "Job title",
      dataType: "string",
    },
    {
      key: "address",
      title: "Address",
      dataType: "address",
    },
  ];
  const data = [
    {
      firstName: "Joe",
      lastName: "Bloggs",
      age: 30,
      jobTitle: "Developer",
      address: "1 Main Street, Town, County, Postcode",
    },
    {
      firstName: "Sarah",
      lastName: "Smith",
      age: 28,
      jobTitle: "Analyst",
      address: "2 Main Street, Town, Country, Postcode",
    },
    {
      firstName: "Mark",
      lastName: "Owens",
      age: 45,
      jobTitle: "Team Lead",
      address: "12 Key Street, Town, Country, Postcode",
    },
    {
      firstName: "Naomi",
      lastName: "Thomas",
      age: 32,
      jobTitle: "Developer",
      address: "8 Side Street, Town, Country, Postcode",
    },
    {
      firstName: "Luke",
      lastName: "Ashford",
      age: 18,
      jobTitle: "Junior Developer",
      address: "5 New Street, Town, Country, Postcode",
    },
  ];
  dataTable.columns = columns;
  dataTable.data = data;
</script>
```

### Embedded

The `embedded` boolean adds a border around the table so it can be added as a standalone table and is not required to stretch the full width of its parent container.

<Canvas withSource="none">
  <Story name="Embedded">{Embedded()}</Story>
</Canvas>

#### Embedded code example

```html
<ic-data-table
  id="data-table"
  caption="Embedded Table"
  embedded="true"
></ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");
  // Copy columns array for 'basic' example
  const columns = [
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
    },
    ...
  ];
  // Copy data array for 'basic' example
  const data = [
    {
      firstName: "Joe",
      lastName: "Bloggs",
      age: 30,
      jobTitle: "Developer",
      address: "1 Main Street, Town, County, Postcode",
    },
    ...
  ];
  dataTable.columns = columns;
  dataTable.data = data;
</script>
```

### Density

The `density` variant provides three different styles for the data table.

- `dense` reduces the padding and font size of the table cells to give the data a more dense style.
- `default` provides a padding of `8px` which is the default spacing. This variant is seen in the first [basic](#basic) example.
- `spacious` gives the data table a more spacious look and feel by increasing the vertical padding as well as the font size.

### Dense

<Canvas withSource="none">
  <Story name="Dense">{Dense()}</Story>
</Canvas>

#### Dense code example

```html
<ic-data-table
  id="data-table"
  caption="Dense Table"
  density="dense"
></ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");
  // Copy columns array for 'basic' example
  const columns = [
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
    },
    ...
  ];
  // Copy data array for 'basic' example
  const data = [
    {
      firstName: "Joe",
      lastName: "Bloggs",
      age: 30,
      jobTitle: "Developer",
      address: "1 Main Street, Town, County, Postcode",
    },
    ...
  ];
  dataTable.columns = columns;
  dataTable.data = data;
</script>
```

### Spacious

<Canvas withSource="none">
  <Story name="Spacious">{Spacious()}</Story>
</Canvas>

#### Spacious code example

```html
<ic-data-table
  id="data-table"
  caption="Spacious Table"
  density="spacious"
></ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");
  // Copy columns array for 'basic' example
  const columns = [
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
    },
    ...
  ];
  // Copy data array for 'basic' example
  const data = [
    {
      firstName: "Joe",
      lastName: "Bloggs",
      age: 30,
      jobTitle: "Developer",
      address: "1 Main Street, Town, County, Postcode",
    },
    ...
  ];
  dataTable.columns = columns;
  dataTable.data = data;
</script>
```

### Sticky column headers

When the height of the data table, the scroll bar will appear to the right. However, by default, the column headers will move up and out of view making it difficult to understand what the data means.
This can be mitigated by using the `sticky-column-headers` prop which takes a boolean. This can be toggled within the example below.

<Canvas withSource="none">
  <Story name="Sticky Column Headers">{Scrollable()}</Story>
</Canvas>

#### Sticky column headers code example

```html
<ic-data-table
  style="height: 366px"
  id="data-table"
  caption="Sticky header Table"
  sticky-column-headers="true"
></ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");
  // Copy columns array for 'basic' example
  const columns = [
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
    },
    ...
  ];
  // Copy data array for 'basic' example
  const data = [
    {
      firstName: "Joe",
      lastName: "Bloggs",
      age: 30,
      jobTitle: "Developer",
      address: "1 Main Street, Town, County, Postcode",
    },
    ...
  ];
  dataTable.columns = columns;
  dataTable.data = data;
</script>
```

### Row headers

Row headers allow headings to be added to individual rows and styles them as column heading. The column array includes an additional `header` key which aligns with the row headers. The structure of the `header` column is the same as the columns.
The data array includes an additional `header` key which takes an object. The title of the row header is set by passing `title` as the key and a value.

<Canvas withSource="none">
  <Story name="Row Headers">{RowHeaders()}</Story>
</Canvas>

#### Row headers code example

```html
<ic-data-table id="data-table" caption="Row headers"></ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");
  // Copy columns array for 'basic' example
  const columns = [
    {
      key: "header",
      title: "Job type",
      dataType: "string",
    },
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
    },
    ...
  ];

  const data = [
    {
      header: { title: 'Employee' }
      firstName: "Joe",
      lastName: "Bloggs",
      age: 30,
      jobTitle: "Developer",
      address: "1 Main Street, Town, County, Postcode",
    },
    ...
  ];
  dataTable.columns = columns;
  dataTable.data = data;
</script>
```

### Sort

Set `sortable` to `true` to set the sort functionality on all columns. It is possible to set the sorting to `unsorted`, `ascending` and `descending` but press the sort buttons next to the column heading.

<Canvas withSource="none">
  <Story name="Sort">{Sort()}</Story>
</Canvas>

#### Sort code example

```html
<ic-data-table id="data-table" caption="Sort" sortable="true"></ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");
  // Copy columns array for 'basic' example
  const columns = [
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
    },
    ...
  ];
  // Copy data array for 'basic' example
  const data = [
    {
      firstName: "Joe",
      lastName: "Bloggs",
      age: 30,
      jobTitle: "Developer",
      address: "1 Main Street, Town, County, Postcode",
    },
    ...
  ];
  dataTable.columns = columns;
  dataTable.data = data;
</script>
```

#### Sort options

It is possible to change the sort options for the sort buttons. The `sortOptions` prop takes an object with `sortOrders` and `defaultColumn`. `sortOrders` makes it possible to change the order to `descending`, `unsorted` and have `ascending` removed. `defaultColumn` sets which column is ordered by default. This is set by padding the column key as the `defaultColumn` value.

<Canvas withSource="none">
  <Story name="Sort Options">{SortOptions()}</Story>
</Canvas>

#### Sort options code example

```html
<ic-data-table
  id="data-table"
  caption="Sort Options"
  sortable="true"
></ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");
  // Copy columns array for 'basic' example
  const columns = [
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
    },
    ...
  ];
  // Copy data array for 'basic' example
  const data = [
    {
      firstName: "Joe",
      lastName: "Bloggs",
      age: 30,
      jobTitle: "Developer",
      address: "1 Main Street, Town, County, Postcode",
    },
    ...
  ];
  dataTable.sortOptions = {
    sortOrders: ['descending', 'unsorted'],
    defaultColumn: 'firstName'
  };
  dataTable.columns = columns;
  dataTable.data = data;
</script>
```

### Pagination

Pagination allows large data sets to be split into pages in order to make the data easier to digest. Setting `show-pagination` to `true` will set append `ic-pagination` to the bottom of the table. There a several sub components within pagination which are set via the `paginationOptions` prop.

- `itemsPerPage` which allows customization of how many items appear on each page. This requires a collection with `label` and `value` key pairs.
- `itemsPerPageControl` which show or hides the `itemsPerPage` component.
- `goToPageControl` displays a textfield and go button which allows jumping between pages in a non-linear approach.

<Canvas withSource="none">
  <Story name="Pagination">{Pagination()}</Story>
</Canvas>

#### Pagination code example

```html
<ic-data-table
  id="data-table"
  caption="Pagination"
  show-pagination="true"
></ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");
  // Copy columns array for 'basic' example
  const columns = [
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
    },
    ...
  ];
  // Copy data array for 'basic' example
  const data = [
    {
      firstName: "Joe",
      lastName: "Bloggs",
      age: 30,
      jobTitle: "Developer",
      address: "1 Main Street, Town, County, Postcode",
    },
    ...
  ];
  dataTable.paginationOptions = {
    itemsPerPage: [
      { label: "5", value: "5" },
      { label: "10", value: "10" },
      { label: "15", value: "15" },
    ],
    itemsPerPageControl: true,
    goToPageControl: true,
  };
  dataTable.columns = columns;
  dataTable.data = data;
</script>
```

### Column overrides

There may be a requirement to style a column differently to the rest of the data to add emphasis. For example, there may be a requirement to centre align data within the 'age' column. To do this, add `columnAlignment` to the column. `columnAlignment` takes an object which sets the `horizontal` and `vertical` property.

- `horizontal` accepts `left`, `right` or `center`.
- `vertical` accepts `top`, `middle`, `bottom`.

<Canvas withSource="none">
  <Story name="Column Overrides">{ColumnOverrides()}</Story>
</Canvas>

#### Column overrides code example

```html
<ic-data-table id="data-table" caption="Column Overrides"></ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");

  const columns = [
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
      columnAlignment: { horizontal: 'center', vertical: 'middle'}
    },
    ...
  ];

  // Copy data array for 'basic' example
  const data = [
    {
      firstName: "Joe",
      lastName: "Bloggs",
      age: 30,
      jobTitle: "Developer",
      address: "1 Main Street, Town, County, Postcode",
    },
    ...
  ];
  dataTable.columns = columns;
  dataTable.data = data;
</script>
```

### Row overrides

Row overrides allow styling to be applied at a row level and is set within the `header` object. The row overrides are used inconjunction with row headers. The following row overrides options apply:

- `rowAlignment` accepts `left`, `right` and `center`.
- `emphasis` accepts `high` or `low`.

<Canvas withSource="none">
  <Story name="Row Overrides">{RowOverrides()}</Story>
</Canvas>

#### Row overrides code example

```html
<ic-data-table id="data-table" caption="Row Overrides"></ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");

  const columns = [
    {
      key: "header",
      title: "Job type",
      dataType: "string",
    },
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
    },
    ...
  ];

  const data = [
    {
      header: {
        title: 'Employee',
        rowAlignment: 'middle',
        emphasis: 'high'
      }
      firstName: "Joe",
      lastName: "Bloggs",
      age: 30,
      jobTitle: "Developer",
      address: "1 Main Street, Town, County, Postcode",
    },
    ...
  ];
  dataTable.columns = columns;
  dataTable.data = data;
</script>
```

### Cell overrides

Cell overrides allows styling to be applied at a granular level. The cell which requires an override accepts an object which contains `data`, `cellAlignment` and `emphasis`.

- `data` is the cell value.
- `cellAlignment` accepts an object with the following key pairs:
  - `horizontal` accepts `left`, `right` or `center`.
  - `vertical` accepts `top`, `middle`, `bottom`.
- `emphasis` accepts `high` or `low`.

<Canvas withSource="none">
  <Story name="Cell Overrides">{CellOverrides()}</Story>
</Canvas>

#### Cell overrides code example

```html
<ic-data-table id="data-table" caption="Cell Overrides"></ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");

  const columns = [
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
    },
    ...
  ];

  const data = [
    {
      firstName: {
        data: "Joe",
        cellAlignment: { horizontal: "center", vertical: "middle" },
        emphasis: "high",
      },
      lastName: "Bloggs",
      age: 30,
      jobTitle: "Developer",
      address: "1 Main Street, Town, County, Postcode",
    },
    ...
  ];
  dataTable.columns = columns;
  dataTable.data = data;
</script>
```

### Default Empty State

When the table recieves no data (either null or an empty array) it will automatically show an ic-empty-state below the headers.

<Canvas withSource="none">
  <Story name="Default Empty State">{Empty()}</Story>
</Canvas>

#### Default Empty State code example

```html
<ic-data-table id="data-table" caption="Default Empty State"></ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");

  const columns = [
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
    },
    ...
  ];
  dataTable.columns = columns;
</script>
```

### Slotted Empty State

You can customise your own `ic-empty-state` component and slot it into the data table using the `empty-state` slot, to reflect different scenarios.

<Canvas withSource="none">
  <Story name="Slotted Empty State">{EmptySlotted()}</Story>
</Canvas>

#### Slotted Empty State code example

```html
<ic-data-table id="data-table" caption="Slotted Empty State">
  <ic-empty-state
    aligned="left"
    heading="Data source error"
    body="Error loading new data"
  >
    <ic-button slot="actions">Retry</ic-button>
  </ic-empty-state>
</ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");

  const columns = [
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
    },
    ...
  ];
  dataTable.columns = columns;
</script>
```

### Loading State

When a user wants to fetch their data asyncronously, a `loading` prop can be set to `true`, which then renders a circular variant of the ic-loading-indicator.
The loading indicator can be customised using the `loadingOptions` prop:

- `appearance` can be `light` or `dark`
- `description` sets the aria-label of the component
- `label` sets the visual message
- `labelDuration` is the number of milliseconds before the label changes
- `showBackground` allows for a white background and grey border to help the indicator stand out

If it needs to be determinate, use `max`, `min` and `progress`.

<Canvas withSource="none">
  <Story name="Loading State" parameters={{ loki: { skip: true } }}>
    {Loading()}
  </Story>
</Canvas>

#### Loading State code example

```html
<ic-data-table id="data-table" caption="Loading State"></ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");

  const columns = [
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
    },
    ...
  ];
  const data = [
    {
      firstName: "Joe",
      lastName: "Bloggs",
      age: 30,
      jobTitle: "Developer",
      address: "1 Main Street, Town, County, Postcode",
    },
    ...
  ];
  dataTable.columns = columns;
  dataTable.data = data;
  dataTable.loading = true;
</script>
```

### Updating State

If certain data in the table has changed, an `updating` prop has been supplied to show a linear ic-loading-indicator just above the data rows.

This prop is also accompanied by an `updatingOptions` prop, which contains similar options to `loadingOptions`, minus `label` and `labelDuration` since the linear version is displayed.

<Canvas withSource="none">
  <Story name="Updating State">{Updating()}</Story>
</Canvas>

#### Updating State code example

```html
<ic-data-table id="data-table" caption="Updating State"></ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");

  const columns = [
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
    },
    ...
  ];
  const data = [
    {
      firstName: "Joe",
      lastName: "Bloggs",
      age: 30,
      jobTitle: "Developer",
      address: "1 Main Street, Town, County, Postcode",
    },
    ...
  ];
  dataTable.columns = columns;
  dataTable.data = data;
  dataTable.updatingOptions = { progress: 30 };
  dataTable.updating = true;
</script>
```

### Links and Elements in data

Custom HTML elements can be slotted or passed via the `data` prop to display in certain cells. When using the slotted method, the slot name follows the format of `{COLUMN_TAG}-{ROW_INDEX}`.

<Canvas withSource="none">
  <Story name="Links and Elements in data">{LinksHTMLElements()}</Story>
</Canvas>

#### Links and Elements in data code example

```html
<ic-data-table
  id="data-table"
  caption="Links and Elements in data"
></ic-data-table>
<script>
  const dataTable = document.querySelector("#data-table");

  const columns = [
    {
      key: "firstName",
      title: "First name",
      dataType: "string",
    },
    ...
    {
      key: "actions",
      title: "Actions",
      dataType: "element",
      columnAlignment: { horizontal: "center" },
    },
  ];

  const data = [
    {
      firstName: {
        data: "Joe",
        href: "https://www.example.com",
      },
      lastName: "Bloggs",
      age: 30,
      jobTitle: "Developer",
      address: "1 Main Street, Town, County, Postcode",
      actions: `<ic-button variant='destructive' onClick='this.closest("tr").remove()'>Delete</ic-button>`,
    },
    ...
  ];
  dataTable.columns = columns;
  dataTable.data = data;
</script>
```
