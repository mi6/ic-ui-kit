import {
  Meta,
  Story,
  Canvas,
  ArgsTable,
  Description,
} from "@storybook/addon-docs";
import { IcDateInput } from "../components";
import { IcButton, IcTypography, IcLink } from "@ukic/react";
import readme from "../../../canary-web-components/src/components/ic-date-input/readme.md";
import { useState } from "react";
import { useArgs } from '@storybook/client-api';

<Meta title="React Components/Date Input" component={IcDateInput} />

# [Canary]: Date Input

Use the date input component to manually type in a date in different formats.

The input `label` is the only required prop for date input.

Click the 'Component API' tab to view all the available props, events and slots for date input.

To use the date input component, import `@ukic/canary-react` into your application.

### Basic

Each example below demonstrates the date input in three different date formats:

- DD/MM/YYYY (Default date format)
- MM/DD/YYYY
- YYYY/MM/DD

Dates can be added by manually typing into the input or using the up and down arrow keys.

To move between day, month and year using the keyboard, provide the required values based on the placeholders or use `/` or `-`.

By default, the helper text displays the date format. 

<Canvas withSource="none">
  <Story name="Basic">
    <IcDateInput
      label="When would you like to collect your coffee?"
      onIcChange={(ev) => console.log(event.detail.value)}
    />
    <br />
    <IcDateInput
      label="When would you like to collect your coffee?"
      dateFormat="MM/DD/YYYY"
    />
    <br />
    <IcDateInput
      label="When would you like to collect your coffee?"
      dateFormat="YYYY/MM/DD"
    />
  </Story>
</Canvas>

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <>
    <IcDateInput label="When would you like to collect your coffee?" />
    <IcDateInput label="When would you like to collect your coffee?" dateFormat="MM/DD/YYYY" />
    <IcDateInput label="When would you like to collect your coffee?" dateFormat="YYYY/MM/DD" />
  </>
);

export default DateInput;
```

Retrieving the date input value via `onIcChange` returns the date as a Date object.

The event returns the Date object when day, month and year have been entered.

<Canvas withSource="none">
  <Story name="onIcChange event">
    <IcDateInput
      label="When would you like to collect your coffee?"
      onIcChange={(ev) => console.log(event.detail.value)}
    />
  </Story>
</Canvas>

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <IcDateInput
    label="When would you like to collect your coffee?"
    onIcChange={(ev) => console.log(event.detail.value)}
  />
);

export default DateInput;
```
### With value

To set a value to the date input, pass the date value in the relevant date format.

<Canvas withSource='none'>
  <Story name="With value" parameters={{ loki: { skip: true } }}>
    <IcDateInput
      id="date-input-default-date-with-value"
      label="When would you like to collect your coffee?"
      value="21/01/2001"
    />
  </Story>
</Canvas>

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <IcDateInput
    label="When would you like to collect your coffee?"
    value="21/01/2001"
  />
);

export default DateInput;
```

The date input also accepts a number of different date formats within the value prop.

- [Date object](#date-object)
- [Zulu datetime](#zulu-datetime)
- [With hyphens (DD-MM-YYYY)](#with-hyphens)
- [Epoch time](#epoch-time)

#### Date object

<Canvas withSource='none'>
  <Story name="Date object">
    <IcDateInput
      label="When would you like to collect your coffee?"
      value={new Date("28 November 2021")}
    />
  </Story>
</Canvas>

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <IcDateInput
    label="When would you like to collect your coffee?"
    value={new Date("28 November 2021")}
  />
);

export default DateInput;
```

#### Zulu datetime

<Canvas withSource='none'>
  <Story name="Zulu datetime">
    <IcDateInput
      label="When would you like to collect your coffee?"
      value={new Date("28 November 2021").toISOString()}
    />
  </Story>
</Canvas>

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <IcDateInput
    label="When would you like to collect your coffee?"
    value={new Date("28 November 2021").toISOString()}
  />
);

export default DateInput;
```

#### With hyphens

<Canvas withSource='none'>
  <Story name="With hyphens">
    <IcDateInput
      label="When would you like to collect your coffee?"
      value="25-05-2005"
    />
  </Story>
</Canvas>

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <IcDateInput
    label="When would you like to collect your coffee?"
    value="25-05-2005"
  />
);

export default DateInput;
```

#### Epoch time

<Canvas withSource='none'>
  <Story name="Epoch time">
    <IcDateInput
      label="When would you like to collect your coffee?"
      value={Date.now()}
    />
  </Story>
</Canvas>

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <IcDateInput
    label="When would you like to collect your coffee?"
    value={Date.now()}
  />
);

export default DateInput;
```

### Required

To set the date input as a required field, add the `required` prop. This will add an asterisk at the end of the date input label.

<Canvas withSource='none'>
  <Story name="Required">
    <IcDateInput label="When would you like to collect your coffee?" required />
  </Story>
</Canvas>

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <IcDateInput label="When would you like to collect your coffee?" required />
);

export default DateInput;
```

### Disabled

Set the `disabled`, to prevent interaction with the date input. 

<Canvas withSource='none'>
  <Story name="Disabled">
    <IcDateInput label="When would you like to collect your coffee?" disabled />
  </Story>
</Canvas>

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <IcDateInput label="When would you like to collect your coffee?" disabled />
);

export default DateInput;
```

### Sizes

The date input is available in three different sizes:
- small
- default
- large

<Canvas withSource='none'>
  <Story name="Sizes">
    <IcDateInput
      label="When would you like to collect your coffee?"
      size="small"
    />
    <br />
    <IcDateInput label="When would you like to collect your coffee?" />
    <br />
    <IcDateInput
      label="When would you like to collect your coffee?"
      size="large"
    />
  </Story>
</Canvas>

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <>
    <IcDateInput label="When would you like to collect your coffee?" size="small" />
    <IcDateInput label="When would you like to collect your coffee?" />
    <IcDateInput label="When would you like to collect your coffee?" size="large" />
  </>
);

export default DateInput;
```

### Custom helper text

Use the helper text to add additional detail for the date input. 

export const UpdatingHelperText = () => {
  const [helpText, setHelpText] = useState("We will have your order ready for you on this date");
  const updateHelperText = () => {
    setHelpText("this is the new helper text");
  } 
  const clearHelperText = (value) => {
    setHelpText("");
  }
  return (
    <>
      <IcDateInput
        label='When would you like to collect your coffee?'
        helperText={helpText}
      />
      <br />
      <div style={{display: 'flex', gap: '8px'}}>
        <IcButton onClick={updateHelperText}>Set helper text</IcButton>
        <IcButton onClick={clearHelperText}>Clear helper text</IcButton>
      </div>
    </>
  )
}

<Canvas withSource='none'>
  <Story name="Custom Helper Text">
    <UpdatingHelperText />
  </Story>
</Canvas>

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <IcDateInput
    label="When would you like to collect your coffee?"
    helperText="We will have your order ready for you on this date"
  />
);

export default DateInput;
```

### Hide Helper Text

Hide visible helper text.

<Canvas withSource='none'>
  <Story name="Hide Helper Text">
    <IcDateInput 
      label="When would you like to collect your coffee?"
      helperText="You cannot see me, but you can hear me"
      hideHelperText="true"
    />
  </Story>
</Canvas>

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <IcDateInput
    label="When would you like to collect your coffee?"
    helperText="You cannot see me, but you can hear me"
    hideHelperText={true}
  />
);

export default DateInput;
```

### Custom validation

Validation on date input is set via `validationStatus` and `validationText`. 

`validationStatus` will set the style of the validation message. `validationStatus` accepts:
- `error`
- `warning`
- `success`

`validationStatus` is required for the `validationText` to appear. 

<Canvas withSource='none'>
  <Story name="Custom validation">
    <IcDateInput
      label="When would you like to collect your coffee?"
      validationStatus="error"
      validationText="There is a coffee shortage forecast for that day. Please choose a different date."
    />
    <br />
    <IcDateInput
      label="When would you like to collect your coffee?"
      validationStatus="warning"
      validationText="Please be aware that there may be a coffee shortage on that day."
    />
    <br />
    <IcDateInput
      label="When would you like to collect your coffee?"
      validationStatus="success"
      validationText="Your coffee will be available for you to collect on this day."
    />
    <br />
  </Story>
</Canvas>

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <>
    <IcDateInput
      label="When would you like to collect your coffee?"
      validationStatus="error"
      validationText="There is a coffee shortage forecast for that day. Please choose a different date."
    />
    <IcDateInput
      label="When would you like to collect your coffee?"
      validationStatus="warning"
      validationText="Please be aware that there may be a coffee shortage on that day."
    />
    <IcDateInput
      label="When would you like to collect your coffee?"
      validationStatus="success"
      validationText="Your coffee will be available for you to collect on this day."
    />
  </>
);

export default DateInput;
```

### Disabled past dates

Validation can be set on the date input if a date in the past has been set by setting the `disablePast` prop.

Enter a date in the past to view the validation message.

<Canvas withSource='none'>
  <Story name="Disabled past dates">
    <IcDateInput
      label="When would you like to collect your coffee?"
      disablePast
    />
  </Story>
</Canvas>

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <IcDateInput
    label="When would you like to collect your coffee?"
    disablePast
  />
);

export default DateInput;
```

### Disabled future dates

Validation can be set on the date input if a date in the future has been set by setting the `disableFuture` prop.

Enter a date in the future to view the validation message.

<Canvas withSource='none'>
  <Story name="Disabled future dates">
    <IcDateInput
      label="When would you like to collect your coffee?"
      disableFuture
    />
  </Story>
</Canvas>

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <IcDateInput
    label="When would you like to collect your coffee?"
    disableFuture
  />
);

export default DateInput;
```

### Min and max

It is possible to set a min and max date range. If a date is set and it is before the min or after the max date, a validation error will appear.

The min or max dates accept the following date formats:

- [Date string](#with-value) (with slashes i.e. DD/MM/YYYY)
- [Date string](#with-hyphens) (with hyphens i.e. DD-MM-YYYY)
- [Date object](#date-object)
- [Zulu time](#zulu-time)

Enter a date after 2nd Jan 2023 and before 20th July to view the validation message.

<Canvas withSource='none'>
  <Story name="Min and max">
    <IcDateInput
      label="When would you like to collect your coffee?"
      min="02-01-2023"
      max="20/07/2023"
    />
  </Story>
</Canvas>

In this code snippet, the min and max have been set using two different date formats to demonstrate its flexibility.

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const DateInput = () => (
  <IcDateInput
    label="When would you like to collect your coffee?"
    min="02-01-2023"
    max="20/07/2023"
  />
);

export default DateInput;
```

### Form

When the date input component is used within a form, the date value is returned as an ISO string.

The value is console logged to the browser dev tools.


export const Form = () => {
  const formSubmit = (e) => {
    console.log(e);
  };
  return (
    <form onSubmit={formSubmit}>
      <IcDateInput
        label="When would you like to collect your coffee?"
        value={new Date("13 March 1951")}
      />
      <IcButton type="submit">Submit</IcButton>
      <IcButton type="reset">Reset</IcButton>
    </form>
  );
};

```jsx
import * as React from "react";
import { IcDateInput } from '@ukic/canary-react';

const Form = () => {
  const formSubmit = (e) => {
    console.log(e);
  };

  return (
    <form onSubmit={formSubmit}>
      <IcDateInput
        label="When would you like to collect your coffee?"
        value={new Date("13 March 1951")}
      />
      <IcButton type="submit">Submit</IcButton>
      <IcButton type="reset">Reset</IcButton>
    </form>
  );
};

export default Form;
```

<Canvas withSource='none'>
  <Story name="Form" parameters={{ loki: { skip: true } }}>
    <Form />
  </Story>
</Canvas>

### With clearing value

export const ClearDateInput = () => {
  const [value, setValue] = useState('21/01/2001');
  const handleUpdate = () => {
    setValue(new Date("05 May 2005"));
  } 
  const handleClearValue = (value) => {
    setValue(value);
  }
  return (
    <>
      <IcDateInput
        label='When would you like to collect your coffee?'
        value={value}
      />
      <br />
      <div style={{display: 'flex', gap: '8px'}}>
        <IcButton onClick={() => handleUpdate()}>Update date</IcButton>
        <IcButton onClick={() => handleClearValue(null)}>Set null</IcButton>
        <IcButton onClick={() => handleClearValue('')}>Set Empty String</IcButton>
        <IcButton onClick={() => handleClearValue(undefined)}>Set undefined</IcButton>
      </div>
    </>
  )
}

The date input can be cleared by setting the the value attribute to one of the following:
- empty string
- `null`
- `undefined`

<Canvas withSource='none'>
  <Story name="With clearing value" parameters={{ loki: { skip: true } }}>
    <ClearDateInput />
  </Story>
</Canvas>

### Playground example

Go to the <IcLink href="/?path=/story/react-components-date-input--playground-example">separate page for the playground example</IcLink> to view the prop controls.

export const defaultArgs = {
  dateFormat: "DD/MM/YYYY",
  disabled: false,
  disableDays: [],
  disableDaysMessage: "This day is not available",
  disableFuture: false,
  disableFutureMessage: "This date is in the future",
  disablePast: false,
  disablePastMessage: "This date is in the past",
  helperText: "Choose a date",
  hideHelperText: false,
  invalidDateMessage: "Invalid date",
  label: "When would you like to collect your coffee?",
  max: "",
  min: "",
  required: false,
  showClearButton: true,
  size: "medium",
  validationStatus: "",
  validationText: "",
  value: "",
};

<Canvas withSource="none">
  <Story
    args={defaultArgs}
    argTypes={{
      dateFormat: {
        options: ["DD/MM/YYYY", "MM/DD/YYYY", "YYYY/MM/DD"],
        control: {
          type: "radio",
        },
      },
      validationStatus: {
        options: ["", "error", "success", "warning"],
        control: {
          type: "radio",
        },
      },
      size: {
        options: ["small", "medium", "large"],
        control: {
          type: "radio",
        },
      },
    }}
    name="Playground example"
  >
    {(args) => {

      const [{ value }, updateArgs] = useArgs();

      const updateDate = (ev) => {
        const date = ev.detail.value;
        let formattedDate;
        date === null ? formattedDate = "" : formattedDate = `${date.getDate()}-${date.getMonth() + 1}-${date.getFullYear()}`;
        updateArgs({ value: formattedDate});
      };

      return(
       <IcDateInput
          dateFormat={args.dateFormat}
          disabled={args.disabled}
          disableDays={args.disableDays}
          disableDaysMessage={args.disableDaysMessage}
          disableFuture={args.disableFuture}
          disableFutureMessage={args.disableFutureMessage}
          disablePast={args.disablePast}
          disablePastMessage={args.disablePastMessage}
          helperText={args.helperText}
          hideHelperText={args.hideHelperText}
          invalidDateMessage={args.invalidDateMessage}
          label={args.label}
          max={args.max}
          min={args.min}
          openAtDate={args.openAtDate}
          required={args.required}
          showDaysOutsideMonth={args.showDaysOutsideMonth}
          showPickerClearButton={args.showPickerClearButton}
          showPickerTodayButton={args.showPickerTodayButton}
          size={args.size}
          startOfWeek={args.startOfWeek}
          validationStatus={args.validationStatus}
          validationText={args.validationText}
          value={value}
          onIcChange={updateDate}
      />
    )}}
  </Story>
</Canvas>